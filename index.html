<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üö® ‡∏ô‡πâ‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</title>

  <!-- Leaflet ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background-color: #f5f5f5;
    }
    h1, h2 {
      color: #d32f2f;
    }
    #map {
      height: 400px;
      margin: 10px 0;
    }
    .news, .danger, .crowd {
      background: #fff;
      padding: 10px;
      margin-bottom: 10px;
      border-left: 5px solid #2196f3;
    }
    button {
      background: #d32f2f;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>üö® ‡∏ô‡πâ‡∏≠‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</h1>

  <h2>üì∞ ‡∏Ç‡πà‡∏≤‡∏ß‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</h2>
  <div id="news-list">
    <!-- ‡∏Ç‡πà‡∏≤‡∏ß‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å backend -->
  </div>

  <h2>üìç ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢</h2>
  <div id="danger-zones"></div>

  <h2>üßç ‡∏à‡∏∏‡∏î‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô</h2>
  <div id="crowd-points"></div>

  <h2>üó∫ ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</h2>
  <div id="map"></div>

  <h2>üÜò ‡∏õ‡∏∏‡πà‡∏° SOS</h2>
  <button onclick="sendSOS()">‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì SOS</button>

  <script>
    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡∏à‡∏≤‡∏Å backend
    fetch('http://localhost:3001/api/news')
      .then(res => res.json())
      .then(data => {
        const newsList = document.getElementById('news-list');
        data.forEach(news => {
          const div = document.createElement('div');
          div.className = 'news';
          div.innerHTML = `<strong>${news.title}</strong><br>${news.content}`;
          newsList.appendChild(div);
        });
      })
      .catch(() => {
        document.getElementById('news-list').innerHTML = '<i>‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πà‡∏≤‡∏ß‡πÑ‡∏î‡πâ</i>';
      });

    // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á
    const dangerZones = [
      { name: "‡∏ã‡∏≠‡∏¢‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ß‡∏´‡∏•‡∏±‡∏á‡∏´‡∏≠ A", lat: 13.282, lng: 100.925 },
      { name: "‡∏´‡∏•‡∏±‡∏á‡∏ï‡∏∂‡∏Å‡∏Ñ‡∏ì‡∏∞‡∏ß‡∏¥‡∏ó‡∏¢‡πå", lat: 13.283, lng: 100.927 }
    ];
    const crowdPoints = [
      { name: "‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏ã‡πÄ‡∏ß‡πà‡∏ô‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏´‡∏•‡∏±‡∏á", lat: 13.284, lng: 100.926 },
      { name: "‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡∏∂‡∏Å 22", lat: 13.282, lng: 100.928 }
    ];

    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á
    const dzContainer = document.getElementById('danger-zones');
    dangerZones.forEach(zone => {
      const div = document.createElement('div');
      div.className = 'danger';
      div.innerText = zone.name;
      dzContainer.appendChild(div);
    });

    const cpContainer = document.getElementById('crowd-points');
    crowdPoints.forEach(p => {
      const div = document.createElement('div');
      div.className = 'crowd';
      div.innerText = p.name;
      cpContainer.appendChild(div);
    });

    // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
    const map = L.map('map').setView([13.2825, 100.9266], 16);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    // ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢
    dangerZones.forEach(zone => {
      L.marker([zone.lat, zone.lng]).addTo(map)
        .bindPopup(`‚ö†Ô∏è ${zone.name}`);
    });

    // ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏à‡∏∏‡∏î‡∏Ñ‡∏ô‡πÄ‡∏¢‡∏≠‡∏∞
    crowdPoints.forEach(p => {
      L.circle([p.lat, p.lng], {
        color: 'green',
        radius: 30
      }).addTo(map).bindPopup(`üßç ${p.name}`);
    });

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô SOS
    function sendSOS() {
      fetch('http://localhost:3001/api/sos', {
        method: 'POST'
      })
        .then(res => res.json())
        .then(data => {
          alert(data.message || "‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        })
        .catch(() => {
          alert("‚ùå ‡∏™‡πà‡∏á‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì SOS ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à");
        });
    }
  </script>
</body>
</html>

